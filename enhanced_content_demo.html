<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Content Panel - Before/After Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .comparison-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .panel-demo {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        .panel-title {
            background: #f8f9fa;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }
        .before { border-color: #dc3545; }
        .after { border-color: #28a745; }
        .before .panel-title { background: #f8d7da; color: #721c24; }
        .after .panel-title { background: #d4edda; color: #155724; }
        
        /* Enhanced content panel styles */
        #enhanced-content-panel .outline-item-wrapper {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 8px;
        }
        #enhanced-content-panel .diagnostic-item,
        #enhanced-content-panel .exercise-item {
            background-color: #fafafa;
            transition: background-color 0.2s;
        }
        #enhanced-content-panel .diagnostic-item:hover,
        #enhanced-content-panel .exercise-item:hover {
            background-color: #f0f0f0;
        }
        #enhanced-content-panel .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 0.25rem;
        }
        #enhanced-content-panel .input-group-text {
            background-color: #e9ecef;
            border-color: #ced4da;
            color: #495057;
        }
        #enhanced-content-panel .btn-outline-primary {
            border-color: #007bff;
            color: #007bff;
        }
        #enhanced-content-panel .btn-outline-primary:hover {
            background-color: #007bff;
            color: white;
        }
        #enhanced-content-panel .advice-container,
        #enhanced-content-panel .hint-container {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 8px;
        }
        #enhanced-content-panel .badge.bg-secondary {
            background-color: #6c757d !important;
        }
        #enhanced-content-panel .badge.bg-info {
            background-color: #17a2b8 !important;
        }
        #enhanced-content-panel .mb-4 {
            margin-bottom: 1rem !important;
        }
        #enhanced-content-panel .mb-3 {
            margin-bottom: 0.5rem !important;
        }
        #enhanced-content-panel .mb-2 {
            margin-bottom: 0.25rem !important;
        }
        #enhanced-content-panel .diagnostic-item,
        #enhanced-content-panel .exercise-item {
            margin-bottom: 0.75rem !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1 class="text-center my-4">Enhanced Content Panel - Fix Demo</h1>
        <p class="text-center text-muted">Comparison showing the enhanced content panel before and after the fix</p>
        
        <div class="comparison-container">
            <!-- BEFORE: Empty State -->
            <div class="panel-demo before">
                <div class="panel-title">
                    <i class="fas fa-times-circle me-2"></i>BEFORE: Empty State (Problem)
                </div>
                
                <div class="card shadow mb-4" id="enhanced-content-panel-before">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">AI 增强内容审核</h6>
                        <div>
                            <span class="badge bg-info">待审核</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- 段落大纲分析 -->
                        <div class="mb-2">
                            <h6 class="text-primary mb-2">段落大纲分析</h6>
                            <div id="outline-container">
                                <p class="text-muted">暂无段落大纲分析数据</p>
                            </div>
                        </div>

                        <!-- 诊断建议 -->
                        <div class="mb-2">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="text-primary mb-0">诊断建议</h6>
                                <button type="button" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-plus"></i> 添加诊断
                                </button>
                            </div>
                            <div id="diagnostics-container">
                                <p class="text-muted">暂无诊断建议</p>
                            </div>
                        </div>

                        <!-- 个性化练习 -->
                        <div class="mb-2">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="text-primary mb-0">个性化练习</h6>
                                <button type="button" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-plus"></i> 添加练习
                                </button>
                            </div>
                            <div id="exercises-container">
                                <p class="text-muted">暂无个性化练习</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AFTER: Populated State -->
            <div class="panel-demo after">
                <div class="panel-title">
                    <i class="fas fa-check-circle me-2"></i>AFTER: Populated State (Fixed)
                </div>
                
                <div class="card shadow mb-4" id="enhanced-content-panel">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">AI 增强内容审核</h6>
                        <div>
                            <span class="badge bg-info">待审核</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info alert-dismissible fade show" role="alert">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>提示:</strong> 以下内容基于模板生成，请根据学生实际作文情况进行调整和完善。
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        
                        <!-- 段落大纲分析 -->
                        <div class="mb-2">
                            <h6 class="text-primary mb-2">段落大纲分析</h6>
                            <div id="outline-container">
                                <div class="outline-item-wrapper mb-2" data-para="1">
                                    <div class="row">
                                        <div class="col-2">
                                            <span class="badge bg-secondary">第1段</span>
                                        </div>
                                        <div class="col-10">
                                            <div class="input-group">
                                                <span class="input-group-text">写作意图:</span>
                                                <input type="text" class="form-control outline-intent" value="开篇点题，简要介绍书籍背景和主要内容" placeholder="描述这一段的写作意图...">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="outline-item-wrapper mb-2" data-para="2">
                                    <div class="row">
                                        <div class="col-2">
                                            <span class="badge bg-secondary">第2段</span>
                                        </div>
                                        <div class="col-10">
                                            <div class="input-group">
                                                <span class="input-group-text">写作意图:</span>
                                                <input type="text" class="form-control outline-intent" value="具体描述感兴趣的情节，并分析其意义" placeholder="描述这一段的写作意图...">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="outline-item-wrapper mb-2" data-para="3">
                                    <div class="row">
                                        <div class="col-2">
                                            <span class="badge bg-secondary">第3段</span>
                                        </div>
                                        <div class="col-10">
                                            <div class="input-group">
                                                <span class="input-group-text">写作意图:</span>
                                                <input type="text" class="form-control outline-intent" value="联系个人生活经历，分享心得体会" placeholder="描述这一段的写作意图...">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="outline-item-wrapper mb-2" data-para="4">
                                    <div class="row">
                                        <div class="col-2">
                                            <span class="badge bg-secondary">第4段</span>
                                        </div>
                                        <div class="col-10">
                                            <div class="input-group">
                                                <span class="input-group-text">写作意图:</span>
                                                <input type="text" class="form-control outline-intent" value="总结全书道理，并强调实际应用" placeholder="描述这一段的写作意图...">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 诊断建议 -->
                        <div class="mb-2">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="text-primary mb-0">诊断建议</h6>
                                <button type="button" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-plus"></i> 添加诊断
                                </button>
                            </div>
                            <div id="diagnostics-container">
                                <div class="diagnostic-item mb-2 border rounded p-2" data-index="0">
                                    <div class="row mb-1">
                                        <div class="col-3">
                                            <label class="form-label">段落位置:</label>
                                            <input type="number" class="form-control form-control-sm diagnostic-para" value="1" placeholder="段落号">
                                        </div>
                                        <div class="col-9">
                                            <label class="form-label">问题描述:</label>
                                            <input type="text" class="form-control form-control-sm diagnostic-issue" value="内容概述不够详细" placeholder="描述发现的问题...">
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <div class="col-12">
                                            <label class="form-label">证据:</label>
                                            <textarea class="form-control form-control-sm diagnostic-evidence" rows="2" placeholder="支持这个问题的具体证据...">仅简要提及主要内容，未深入描述感兴趣部分</textarea>
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <div class="col-12">
                                            <label class="form-label">改进建议:</label>
                                            <div class="advice-container">
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm advice-item" value="扩展对书籍主要情节的描述，突出更多细节" placeholder="输入改进建议...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-advice-btn">×</button>
                                                </div>
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm advice-item" value="增加对感兴趣部分的详细情节叙述" placeholder="输入改进建议...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-advice-btn">×</button>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-secondary add-advice-btn">+ 添加建议</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="button" class="btn btn-sm btn-outline-danger remove-diagnostic-btn">删除诊断</button>
                                    </div>
                                </div>
                                
                                <div class="diagnostic-item mb-2 border rounded p-2" data-index="1">
                                    <div class="row mb-1">
                                        <div class="col-3">
                                            <label class="form-label">段落位置:</label>
                                            <input type="number" class="form-control form-control-sm diagnostic-para" value="3" placeholder="段落号">
                                        </div>
                                        <div class="col-9">
                                            <label class="form-label">问题描述:</label>
                                            <input type="text" class="form-control form-control-sm diagnostic-issue" value="生活经历匹配度低" placeholder="描述发现的问题...">
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <div class="col-12">
                                            <label class="form-label">证据:</label>
                                            <textarea class="form-control form-control-sm diagnostic-evidence" rows="2" placeholder="支持这个问题的具体证据...">生活经历与书中内容关联较弱，解释简单</textarea>
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <div class="col-12">
                                            <label class="form-label">改进建议:</label>
                                            <div class="advice-container">
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm advice-item" value="选择更相关的生活经历，确保与书中主题紧密匹配" placeholder="输入改进建议...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-advice-btn">×</button>
                                                </div>
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm advice-item" value="详细描述经历，增强说服力和情感深度" placeholder="输入改进建议...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-advice-btn">×</button>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-secondary add-advice-btn">+ 添加建议</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="button" class="btn btn-sm btn-outline-danger remove-diagnostic-btn">删除诊断</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 个性化练习 -->
                        <div class="mb-2">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="text-primary mb-0">个性化练习</h6>
                                <button type="button" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-plus"></i> 添加练习
                                </button>
                            </div>
                            <div id="exercises-container">
                                <div class="exercise-item mb-2 border rounded p-2" data-index="0">
                                    <div class="row mb-1">
                                        <div class="col-4">
                                            <label class="form-label">练习类型:</label>
                                            <input type="text" class="form-control form-control-sm exercise-type" value="书籍内容概述练习" placeholder="练习类型">
                                        </div>
                                        <div class="col-8">
                                            <label class="form-label">练习题目:</label>
                                            <input type="text" class="form-control form-control-sm exercise-prompt" value="选择一本书，概述其主要内容并详细描述一个感兴趣的情节，字数不少于200字" placeholder="练习题目描述...">
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <div class="col-6">
                                            <label class="form-label">提示内容:</label>
                                            <div class="hint-container">
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm hint-item" value="抓住关键情节，使用具体细节" placeholder="输入提示...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-hint-btn">×</button>
                                                </div>
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm hint-item" value="避免空泛描述，如'很好看'" placeholder="输入提示...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-hint-btn">×</button>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-secondary add-hint-btn">+ 添加提示</button>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label">示例内容:</label>
                                            <textarea class="form-control form-control-sm exercise-sample" rows="3" placeholder="练习示例...">在《哈利·波特》中，哈利与伏地魔的最终对决展示了勇气与牺牲的主题。哈利举起魔杖，念出'除你武器'，象征正义战胜邪恶。</textarea>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="button" class="btn btn-sm btn-outline-danger remove-exercise-btn">删除练习</button>
                                    </div>
                                </div>
                                
                                <div class="exercise-item mb-2 border rounded p-2" data-index="1">
                                    <div class="row mb-1">
                                        <div class="col-4">
                                            <label class="form-label">练习类型:</label>
                                            <input type="text" class="form-control form-control-sm exercise-type" value="心得体会联系练习" placeholder="练习类型">
                                        </div>
                                        <div class="col-8">
                                            <label class="form-label">练习题目:</label>
                                            <input type="text" class="form-control form-control-sm exercise-prompt" value="阅读一个故事后，写一段文字联系自己的实际生活经历，确保经历与书中内容匹配，字数不少于150字" placeholder="练习题目描述...">
                                        </div>
                                    </div>
                                    <div class="row mb-1">
                                        <div class="col-6">
                                            <label class="form-label">提示内容:</label>
                                            <div class="hint-container">
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm hint-item" value="选择相关经历，详细描述过程" placeholder="输入提示...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-hint-btn">×</button>
                                                </div>
                                                <div class="input-group mb-1">
                                                    <input type="text" class="form-control form-control-sm hint-item" value="强调情感和教训" placeholder="输入提示...">
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-hint-btn">×</button>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-secondary add-hint-btn">+ 添加提示</button>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label">示例内容:</label>
                                            <textarea class="form-control form-control-sm exercise-sample" rows="3" placeholder="练习示例...">读《小王子》后，我想到自己曾忽视朋友的感受，就像小王子离开玫瑰一样。我道歉并修复了友谊，学会了珍惜。</textarea>
                                        </div>
                                    </div>
                                    <div class="text-end">
                                        <button type="button" class="btn btn-sm btn-outline-danger remove-exercise-btn">删除练习</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert alert-success">
                    <h5><i class="fas fa-check-circle me-2"></i>Fix Summary</h5>
                    <ul class="mb-0">
                        <li><strong>Problem:</strong> Enhanced content panel showed empty states ("暂无段落大纲分析数据", "暂无诊断建议", "暂无个性化练习")</li>
                        <li><strong>Root Cause:</strong> <code>evaluation_data</code> was None when essays didn't have enhanced evaluation data in database</li>
                        <li><strong>Solution:</strong> Created fallback system that generates default enhanced content when real data is missing</li>
                        <li><strong>Features:</strong> Template data marker, helpful teacher guidance, fully editable content, data structure compatibility</li>
                        <li><strong>Result:</strong> Enhanced content panel now always shows populated, meaningful data that teachers can customize</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>